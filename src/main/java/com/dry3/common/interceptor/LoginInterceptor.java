package com.dry3.common.interceptor;import com.dry3.common.Const;import com.dry3.common.ResponseCode;import com.dry3.common.ServerResponse;import com.dry3.pojo.User;import org.codehaus.jackson.map.ObjectMapper;import org.springframework.web.servlet.HandlerInterceptor;import org.springframework.web.servlet.ModelAndView;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.PrintWriter;/** * Created by dry3 */public class LoginInterceptor implements HandlerInterceptor {    private ObjectMapper objectMapper = new ObjectMapper();    @Override    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object o) throws Exception {        if (request.getHeader("X-Requested-With") != null && request.getHeader("X-Requested-With").equalsIgnoreCase("XMLHttpRequest")) {            User currentUser = (User) request.getSession().getAttribute(Const.CURRENT_USER);            PrintWriter writer = response.getWriter();            System.out.println("异步拦截成功");            try {                if (currentUser == null) {                    String result = objectMapper.writeValueAsString(ServerResponse.createByErrorCodeMessage(ResponseCode.NEED_LOGIN.getCode(), "用户未登录,请登录"));                    writer.write(result);                    writer.flush();                    return false;                }            } finally {                writer.close();            }        }        System.out.println("拦截成功");        return true;    }    @Override    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception {    }    @Override    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception {    }}